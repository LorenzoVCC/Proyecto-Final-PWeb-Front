<div class="flex-center">

    <div class="back-to-menu-btn-container">
        <a routerLink=""><img src="/assets/imgs/back-to-menu.svg" alt=""></a>
    </div>

    <!-- ////////////////////////////// -->
    <div class="main-container">
        <!-- //////////// BANNER  //////////// -->
        <section id="main-banner"
            [style.background-image]="'url(' + (restaurant?.bgImage || '/assets/imgs/restaurant-generic-img.jpg') + ')'">

            <div class="banner-info-positioning">
                <img class="restaurant-logo" [src]="restaurant?.imageUrl || '/assets/imgs/restaurant-generic-img.jpg'"
                    alt="restaurant logo" />

                <div class="banner-info">
                    <h1>{{ restaurant?.name }}</h1>
                    <p>{{ restaurant?.description }}</p>
                </div>
            </div>
        </section>
        <!--  -->

        @if (!searching && featuredProducts.length) {
        <section class="container-for-featured">
            <div class="category-header-featured">
                <h2>⭐ Destacados ⭐</h2>
            </div>

            <div class="featured-container">
                @for (p of featuredProducts; track p.id_Product) {
                <product-card [product]="p" [compact]="true"></product-card>
                }
            </div>
        </section>
        }


        <!-- //////////////  PILLS   //////////////// -->
        <section id="categories-container-0">

            <div class="pills-plus">
                <div class="categories-container-1">

                    @for (cat of categories; track $index) {
                    <category-pill [category]="cat" (click)="selectCategory(cat.Id_Category)"
                        [class.selected]="selectedCategoryId === cat.Id_Category"></category-pill>
                    }
                    @empty
                    {
                    <p>No hay categorías.</p>
                    }

                </div>
                <!--  -->

                @if (auth.token && auth.restaurantId === restaurant?.id) {
                <div class="category-btn-container">
                    <button class="add-category-btn btn-pencil" type="button" (click)="updateSelectedCategory()"
                        [disabled]="selectedCategoryId === null" [class.is-disabled]="selectedCategoryId === null">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="pencil-edit-cat">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                        </svg>

                    </button>
                    <button class="add-category-btn" type="button" (click)="deleteSelectedCategory()"
                        [disabled]="selectedCategoryId === null" [class.is-disabled]="selectedCategoryId === null">
                        -
                    </button>
                    <a [routerLink]="['/create-category', id()]"><button class="add-category-btn"
                            type="button">+</button>
                    </a>
                </div>
                }

            </div>

        </section>

        <!-- ////////////// SEARCHBAR ////////////// -->
        <div class="searchbar-container main-searchbar">

            <div class="searchbar-products-container">
                <input type="text" class="searchbar" placeholder="Buscar productos..."
                    (input)="onSearchInput($event)" />
            </div>

            <div class="filters-btn-container" (click)="toggleFilters()">
                <img src="/assets/imgs/filters.svg" alt="Filtros">
            </div>


            @if (filtersOpen) {
            <div class="filters-dropdown">
                <div class="row">
                    <label>Min</label>
                    <input type="number" [(ngModel)]="minPrice" name="minPrice"
                        (ngModelChange)="minPrice = ($event === '' ? null : +$event)">
                </div>

                <div class="row">
                    <label>Max</label>
                    <input type="number" [(ngModel)]="maxPrice" name="maxPrice"
                        (ngModelChange)="maxPrice = ($event === '' ? null : +$event)">
                </div>

                <div class="checkbox-row">
                    <label>
                        <input type="checkbox" class="check" [(ngModel)]="onlyFeatured" name="onlyFeatured">
                        Solo destacados
                    </label>
                </div>

                <div class="checkbox-row">
                    <label>
                        <input type="checkbox" class="check" [(ngModel)]="onlyHappyHour" name="onlyHappyHour">
                        Solo happy hour
                    </label>
                </div>

                <div class="buttons-filters">
                    <button type="button" (click)="applyFilters()">Aplicar</button>
                    <button type="button" (click)="clearFilters()">Limpiar</button>
                </div>
            </div>
            }


        </div>


        <!-- /////////////////CONTAINER Y PRODUCT CARDS//////////////// -->

        <section id="products-container-0">

            @if (searching) {

            <section class="container-for-category">
                <div class="category-header">
                    <h2>Resultados</h2>
                </div>

                <div class="products-container-1">
                    @for (p of searchResults; track p.id_Product) {
                    <product-card [product]="p"></product-card>
                    }
                    @empty {
                    <p>No se encontraron productos.</p>
                    }
                </div>
            </section>


            } @else {

            @for (c of categories; track c.Id_Category) {

            @if (selectedCategoryId === null || selectedCategoryId === c.Id_Category) {
            <section class="container-for-category">

                <div class="category-header">
                    <h2>{{ c.Name }}</h2>

                    @if (auth.token && auth.restaurantId === restaurant?.id) {
                    <a [routerLink]="['/new-product-page', restaurant?.id, c.Id_Category]">
                        <button class="add-category-btn" type="button">+</button>
                    </a>
                    }
                </div>

                <div class="products-container-1">
                    @for (p of getProductsForCategoryView(c.Id_Category); track p.id_Product) {
                    <product-card [product]="p"></product-card>
                    }
                    @empty {
                    <p>La categoría no contiene productos aún.</p>
                    }
                </div>

            </section>
            }

            }
            @empty {
            <p>No hay categorías para mostrar productos.</p>
            }

            }
        </section>
    </div>
</div>